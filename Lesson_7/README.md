# Домашняя работа №7
## Условие

Выполнить следующие задания и подготовить развёртывание результата выполнения с использованием Vagrant и Vagrant shell provisioner (или Ansible, на Ваше усмотрение):
1. Создать сервис и unit-файлы для этого сервиса:
- сервис: bash, python или другой скрипт, который мониторит log-файл на наличие ключевого слова;
- ключевое слово и путь к log-файлу должны браться из /etc/sysconfig/ (.service);
- сервис должен активироваться раз в 30 секунд (.timer).

2. Дополнить unit-файл сервиса httpd возможностью запустить несколько экземпляров сервиса с разными конфигурационными файлами.

3. Создать unit-файл(ы) для сервиса:
- сервис: Kafka, Jira или любой другой, у которого код успешного завершения не равен 0 (к примеру, приложение Java или скрипт с exit 143);
- ограничить сервис по использованию памяти;
- ограничить сервис ещё по трём ресурсам, которые не были рассмотрены на лекции;
- реализовать один из вариантов restart и объяснить почему выбран именно этот вариант.


Для выполнения домашнего задания использовал методичку к уроку. Необходимо скачать из данного репозитория GitHub каталог Lesson_7 и перейти в него, далее необходимо выполнить в терминале

        vagrant up

### 1. timer

        sudo tail -f /var/log/messages

### 2. httpd

        sudo ss -tnulp | grep httpd

### 3. kafka

Для выполнения данного задания установил kafka.
Для корректного завершения службы kafka добавил в unit файл

        SuccessExitStatus=143

Сервис kafka ограничил следующими параметрами

        CPUShares=1500 - распределение процессорного времени (по умолчанию 1024)
        MemoryLimit=1G - ограничение памяти
        BlockIOWeight=500 - задаёт долю полосы ввода/вывода для указанной службы
        BlockIOReadBandwith=/var/log 5M - в результате, для данной службы скорость чтения с устройства, содержащего каталог
                                          /var/log, будет ограничена величиной 5 мегабайт в секунду

Для службы kafka настроил опцию **Restart=on-failure** и таймаут перезапуска 60 сек. *on-failure* рекомендуется для служб, которые должны работать постоянно. Для проверки можно убить процесс kafka и через 60 секунд служба перезапустится автоматически.

        Узнать PID
        sudo systemctl status kafka | grep PID

        Убить процесс
        kill 9 PID (из вывода в предыдущей команды)

Если проверить через 60 секунд, то служба будет опять запущена.

        sudo systemctl status kafka

